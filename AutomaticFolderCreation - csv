<# Script to create user folders from a CSV file #>

Clear-Host

"This script creates folders from a .CSV file"

$Continue = Read-Host -Prompt "Do you want to continue running this script?"
if ($continue -eq "Y" -eq "y") {$null; Clear-Host}
if ($Continue -eq "N" -eq "n") {Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/Sagaichi/Powershell/main/AutomationScripts.ps1'))}

$Drive = Read-Host -Prompt "Where do you want to create these folders? (e.g. C:\Desktop)"

Set-Location "$Drive"

# Open file dialog
# Load Windows Forms
[System.Reflection.Assembly]::LoadWithPartialName("System.windows.forms") | Out-Null

# Create and show open file dialog
$dialog = New-Object System.Windows.Forms.OpenFileDialog
$dialog.InitialDirectory = $StartDir
$dialog.Filter = "CSV (*.csv)| *.csv" 
$dialog.ShowDialog() | Out-Null

# Get file path
$CSVFile = $dialog.FileName

# Import file into variable
# Lets make sure the file path was valid
# If the file path is not valid, then exit the script
if ([System.IO.File]::Exists($CSVFile)) {
    Write-Host "Importing CSV..."
    $CSV = Import-Csv -LiteralPath "$CSVFile"
} else {
    Write-Host "File path specified was not valid"
    Exit
}

# Lets iterate over each line in the CSV file
foreach ($user in $CSV) {

    # Format's the Folder name
    $Folder = "$($user.'First Name').$($user.'Last Name').$($User.'Student ID')"
    $Folder = $Folder.Replace(" ", "")

    # Creates the Folders
    New-Item -Path "$Drive" -Name "$Folder" 

}

Write-Host "Created $Folder in $Drive"
Pause